function refresh(){var b,a=getBreadcrumb();a.reverse(),b=a[a.length-1],b["data-action"]=ctx+"/weiXin/customMenu/preview",a[a.length-1]=b,a.reverse(),refreshBreadcrumb(a),$("div").find(".page-content").load(ctx+"/weiXin/customMenu/preview",function(){})}jQuery(function(a){function b(b){a("#jsDelBt").on("click",function(){a("#dialog-confirm-context").html("删除确认删除后该菜单下设置的消息将不会被保存"),a("#dialog-confirm").removeClass("hide").dialog({resizable:!1,modal:!0,title:"<div class='widget-header'><h4 class='smaller'><i class='ace-icon fa fa-exclamation-triangle red'></i>温馨提示</h4></div>",title_html:!0,buttons:[{html:"<i class='ace-icon fa fa-check-square-o bigger-110'></i>&nbsp; 确认","class":"btn btn-danger btn-xs",click:function(){var d,c={};c[1]=b,d=JSON.stringify(c),a.ajax({url:ctx+"/weiXin/customMenu/delete1",type:"POST",async:!1,contentType:"application/json;charset=UTF-8",data:d,success:function(a){refresh(),console.log(a.result)},complete:function(){},error:function(){alert("删除失败")}}),a(this).dialog("close")}},{html:"<i class='ace-icon fa fa-times bigger-110'></i>&nbsp; 取消","class":"btn btn-xs",click:function(){a(this).dialog("close"),refresh()}}]})})}function c(b){a("#jsChangeBt").on("click",function(){var c=a(this).parent("span").siblings("#title2").html().trim(),d=a(this).parent("span").siblings("#title1").text().substring(0,4);a("#text").attr("placeholder",c),a("#dialog-message").children("#p1").hide(),a("#dialog-message").removeClass("hide").dialog({modal:!0,title:"<div class='widget-header widget-header-small'><h4 class='smaller'> 修改"+d+"名称</h4></div>",title_html:!0,buttons:[{text:"取消","class":"btn btn-xs",click:function(){a(this).dialog("close")}},{text:"确定","class":"btn btn-primary btn-xs",click:function(){var e,c=a(this).children("#p2").children("#text").val(),d={};d[1]=b,d[2]=c,e=JSON.stringify(d),a.ajax({url:ctx+"/weiXin/customMenu/upDate",type:"POST",async:!1,contentType:"application/json;charset=UTF-8",data:e,success:function(a){refresh(),console.log(a.result)},complete:function(){},error:function(){alert("重命名失败")}}),a(this).dialog("close")}}]})})}function d(b,c,d){var e;e="0"==c?"添加二级菜单":"添加一级菜单",a("#dialog-message").removeClass("hide").dialog({modal:!0,title:"<div class='widget-header widget-header-small'><h4 class='smaller'> <i class='ace-icon fa fa-check'></i> "+e+"</h4></div>",title_html:!0,buttons:[{text:"取消","class":"btn btn-xs",click:function(){a("#menuName").val(""),a(".js_titleEorTips").hide(),a(".js_titlenoTips").hide(),a(this).dialog("close")}},{text:"确定","class":"btn btn-primary btn-xs",click:function(){var f,g,c=a(this).children("#p2").children("#menuName").val(),e=c.replace(/[^\x00-\xff]/g,"aa");""==c?alert("菜单名不能为空，请输入菜单名"):e.length<=8?(f={},f[1]=b,f[2]=c,f[3]="menu",f[4]="1",f[5]=d,g=JSON.stringify(f),a.ajax({url:ctx+"/weiXin/customMenu/addSublist",type:"POST",async:!1,contentType:"application/json;charset=UTF-8",data:g,success:function(){refresh()},complete:function(){},error:function(){alert("添加失败")}}),a("#menuName").val(""),a(this).dialog("close")):alert("添加失败")}}]})}a(".addd1").on("click",function(){var e=5-a(this).next("ul").children("li").length,f=a(this).children(".menu1").text(),g=a(this).attr("name"),h=a(this).children("div").data("pid");a(this).children("div").attr("dateid"),c(h),b(h),a("#context0").siblings().hide(),a("#context0").show(),a("#title1").html(g+":"),a("#title2").html(f),a("#dialog-message").children("#p1").show(),a("#title3").show(),e>0?5==e?(a("#context2").siblings().hide(),a("#context2").show(),a("#context2 span").html(f),a("#context2 #initialCreate").on("click",function(b){b.stopPropagation(),a("#p1").html("还能添加"+e+"个二级菜单，请输入名称（8个汉字或16个字母以内）"),d(h)}),a("#context2 #sendMsg").on("click",function(b){b.stopPropagation(),a("#p1").html("还能添加"+e+"个二级菜单，请输入名称（8个汉字或16个字母以内）"),d(h)}),a("#context2 #goPage").on("click",function(b){b.stopPropagation(),a("#context3").siblings().hide(),a("#context3").show()})):(a("#context0").children("p").siblings().show(),a("#context0").children("p").html('已为"'+f+'"添加了二级菜单，无法设置其他内容。你还可以添加'+e+"个二级菜单"),a("#context0 #initialCreate").on("click",function(b){b.stopPropagation(),a("#p1").html("还能添加"+e+"个二级菜单，请输入名称（8个汉字或16个字母以内）"),d(h)})):(a("#context0").children("p").siblings().hide(),a("#context0").children("p").html("您已加满5个二级菜单！<br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/>"))}),a(".addd2").on("click",function(){var f,g,d=a(this).children("div").data("pid");a(this).children("div").attr("dateid"),c(d),b(d),f=a(this).text(),g=a(this).attr("name"),a("#title3").show(),a("#context1 span").html(f),a("#context1").siblings().hide(),a("#context1").show(),a("#title1").html(g+":"),a("#title2").html(f),a("#context1 #sendMsg").on("click",function(b){b.stopPropagation(),a("#context3").siblings().hide(),a("#context3").show()}),a("#context1 #goPage").on("click",function(b){b.stopPropagation(),a("#context3").siblings().hide(),a("#context3").show()})}),a.widget("ui.dialog",a.extend({},a.ui.dialog.prototype,{_title:function(a){var b=this.options.title||"&nbsp;";"title_html"in this.options&&1==this.options.title_html?a.html(b):a.text(b)}})),a(".addMenu").on("click",function(b){var c,e,f,g,h;b.preventDefault(),c=a(this).parent(".addd1").next("ul").children("li").length,e=5-a(this).parent(".addd1").next("ul").children("li").length,f=a(this).attr("name"),g=a(this).attr("dateid"),"一级菜单"!=f?(h=a(this).data("pid"),e>0?(a("#p1").html("还能添加"+e+"个"+f),d(h,g,c)):(a("#tip1").html("同一级一级菜单下只能添加5个二级菜单，当前已达设置上限！"),a("#tip1").fadeIn(500).delay(2e3).fadeOut(500))):"一级菜单"==f&&(h=a(this).data("pid"),c=a(".addd1 span").length,e=3-a(".addd1 span").length,e>0?(a("#p1").html("还能添加"+e+"个"+f+"，请输入名称"),d(h,g,c)):(a("#tip1").html("最多只能添加3个一级菜单，当前已达设置上限！"),a("#tip1").fadeIn(500).delay(2e3).fadeOut(500)))}),a(".nestable-handle a").on("mousedown",function(a){a.stopPropagation()}),a(".jsViewLi").on("click",function(){a(".jsSubViewDiv").css("display","none"),a(this).children(".jsSubViewDiv").css("display","block")}),a("#viewBt").on("click",function(){a("#mask").css("display","block"),a("#mask").spin({color:"#fff"}),a("#mobileDiv").css("display","block"),a.ajax({url:ctx+"/weiXin/customMenu/getPreview",type:"POST",async:!1,dataType:"json",traditional:!0,contentType:"application/json;charset=UTF-8",data:"",success:function(b){var d=b.previewlist,e="",f="";a.each(d,function(b,c){var d="",g=c.children;a.each(g,function(a,b){var c="";c+='<li id="subMenu_menu_0_0"><a title="'+b.menuName+'" class="jsSubView"href="javascript:void(0);">'+b.menuName+"</a></li>",f+=c}),d+='<li id="menu_0" class="pre_menu_item grid_item size1of3 jsViewLi"><a title="'+c.menuName+'" class="jsView pre_menu_link"	href="javascript:void(0);"> <i class="icon_menu_dot"></i>'+c.menuName+" </a>"+'<div style="" class="sub_pre_menu_box jsSubViewDiv">'+'<ul class="sub_pre_menu_list">'+f+"</ul>"+'<i class="arrow arrow_out"></i> <i class="arrow arrow_in"></i>'+"</div>"+"</li>",f="",e+=d}),a("#viewList").html(e)},complete:function(){},error:function(){alert("error啦")}})}),a("#viewClose").on("click",function(){a("#mask").css("display","none"),a("#mobileDiv").css("display","none")});var e=[];a("#id-check-horizontal").removeAttr("checked").on("click",function(){a(".action_tips").html("请通过拖拽左边的菜单进行排序"),this.checked?(a("#sorts").attr("data-original-title","取消"),a(".move-ul").sortable({opacity:.6,delay:10,stop:function(){var c=a("#sortables");step=function(b){var c=[],d=b.children("ul").children("li");return d.each(function(){var b={},d=a(this),e=d.children("ul").children("li");b.id=d.data("id"),e.length&&(b.children=step(d)),c.push(b)}),c},e=step(c)}}),a(".move-ul").sortable("enable")):(a("#sorts").attr("data-original-title","排序"),a(".action_tips").html("你可以点击左侧菜单或添加一个新菜单，然后设置菜单内容"),a(".move-ul").sortable("disable"))}),a("[data-rel='tooltip']").tooltip(),a("#pubBt").on("click",function(b){var c,d;b.preventDefault(),a("#dialog-confirm-context").html("发布确认,本次发布将在24小时内对所有用户生效。确认发布？"),a("#dialog-confirm").removeClass("hide").dialog({resizable:!1,modal:!0,title:"<div class='widget-header'><h4 class='smaller'><i class='ace-icon fa fa-exclamation-triangle red'></i>温馨提示</h4></div>",title_html:!0,buttons:[{html:"<i class='ace-icon fa fa-check-square-o bigger-110'></i>&nbsp; 确认","class":"btn btn-danger btn-xs",click:function(){a(this).dialog("close")}},{html:"<i class='ace-icon fa fa-times bigger-110'></i>&nbsp; 取消","class":"btn btn-xs",click:function(){a(this).dialog("close"),refresh()}}]}),c={},c.data=e,d=JSON.stringify(c),a.ajax({url:ctx+"/weiXin/customMenu/editMenu",type:"POST",async:!1,traditional:!0,contentType:"application/json;charset=UTF-8",data:d,success:function(a){refresh(),console.log(a.result)},complete:function(){},error:function(){alert("error啦")}})})}),$(".js_menu_name").on("input propertychange",function(){var a=$(this).val().replace(/[^\x00-\xff]/g,"aa");0==a.length?$(".js_titlenoTips").show():$(".js_titlenoTips").hide(),a.length>8?$(".js_titleEorTips").show():$(".js_titleEorTips").hide()});